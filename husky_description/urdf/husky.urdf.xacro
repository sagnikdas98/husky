<?xml version='1.0'?>

<robot name="husky" xmlns:xacro="http://www.ros.org/wiki/xacro">
    <xacro:property name="cameraSize" value="0.05"/>
    <xacro:property name="cameraMass" value="0.01"/>
    <xacro:arg name="robot_namespace" default=""/>
    <xacro:property name="namespace" value="$(arg robot_namespace)" />
    <xacro:include filename="$(find husky_description)/urdf/macros.xacro" />

<!-- Base Frame -->
    <link name='base_link'>
      <inertial>
          <mass value="1"/>
          <origin xyz="0 0 0" rpy=" 0 0 0"/>
          <inertia 
          ixx="1" ixy="0.0" ixz="0"
          iyy="1" iyz="0.0"
          izz="1"
          />
        </inertial> 
        <collision name='collision'>
          <origin xyz="0.1575 0.0775 0.08" rpy="1.5708 0 1.5708"/>
          <geometry>
            <box size="0.315 0.155 0.215" />
          </geometry>
        </collision>

        <visual name='base_link_visual'>
          <origin xyz="0.1575 0.0775 0.08" rpy="1.5708 0 1.5708"/>
          <geometry>
              <box size="0.315 0.155 0.215" />
          </geometry>
          <material name="black">
           <color rgba="0 0 0 0.5"/>
         </material>
        </visual>
    </link>

   <link name="rear_left_wheel">
        <collision name="collision">
          <origin xyz="0.01 0 0" rpy="1.5708 0 1.5708"/>
          <geometry>
            <cylinder length="0.04" radius="0.055"/>
          </geometry>
          <surface>
            <friction>
              <ode>
                <mu>10</mu>
                <mu2>10</mu2>
              </ode>
            </friction>
          </surface>
        </collision>
        <visual name="rear_left_wheel_visual">
          <origin xyz="0.01 0 0" rpy="1.5708 0 1.5708"/>     
          <geometry>
            <cylinder length="0.04" radius="0.055"/>
          </geometry>
        </visual>
        <inertial>
          <origin xyz="0 0 0"/>
          <mass value="0.5"/>
          <inertia 
          ixx="0.005" ixy="0.0" ixz="0.0" 
          iyy="0.01" iyz="0.0" 
          izz="0.005"/>
        </inertial>
    </link>

    <link name="rear_right_wheel">
        <collision name="collision">
          <origin xyz="0.31 0 0" rpy="1.5708 0 1.5708"/>
          <geometry>
            <cylinder length="0.04" radius="0.055"/>
          </geometry>
          <surface>
            <friction>
              <ode>
                <mu>10</mu>
                <mu2>10</mu2>
              </ode>
            </friction>
          </surface>
        </collision>
        <visual name="rear_right_wheel_visual">
          <origin xyz="0.31 0 0" rpy="1.5708 0 1.5708"/>
          <geometry>
            <cylinder length="0.04" radius="0.055"/>
          </geometry>
        </visual>
        <inertial>
          <origin xyz="0 0 0"/>
          <mass value="0.5"/>
          <inertia 
          ixx="0.005" ixy="0.0" ixz="0.0" 
          iyy="0.01" iyz="0.0" 
          izz="0.005"/>
        </inertial>
    </link>

    <joint type="continuous" name="rear_left_wheel_hinge">
        <child link="rear_left_wheel"/>
        <parent link="base_link"/>
        <!-- <parent link="axle_RL"/> -->
        <axis xyz="1 0 0" rpy="0 0 0"/>
        <limit effort="1" velocity="10"/>
        <joint_properties damping="5.0" friction="1.0"/>
    </joint>
    <transmission name="rear_left_wheel_trans" type="SimpleTransmission">
        <type>transmission_interface/SimpleTransmission</type>
        <actuator name="rear_left_wheel_motor">
          <mechanicalReduction>1</mechanicalReduction>
        </actuator>
        <joint name="rear_left_wheel_hinge">
          <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
        </joint>
    </transmission>

    <joint type="continuous" name="rear_right_wheel_hinge">
        <child link="rear_right_wheel"/>
        <parent link="base_link"/>
        <!-- <parent link="axle_RR"/> -->
        <axis xyz="1 0 0" rpy="0 0 0"/>
        <limit effort="1" velocity="10"/>
        <joint_properties damping="5.0" friction="1.0"/>
    </joint>
    <transmission name="rear_right_wheel_trans" type="SimpleTransmission">
        <type>transmission_interface/SimpleTransmission</type>
        <actuator name="rear_right_wheel_motor">
          <mechanicalReduction>1</mechanicalReduction>
        </actuator>
        <joint name="rear_right_wheel_hinge">
          <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
        </joint>
        </transmission>


   <link name="front_left_wheel">
        <collision name="collision">
          <origin xyz="0.01 0 0" rpy="1.5708 0 1.5708"/>
          <geometry>
            <cylinder length="0.04" radius="0.055"/>
          </geometry>
          <surface>
            <friction>
              <ode>
                <mu>10</mu>
                <mu2>10</mu2>
              </ode>
            </friction>
          </surface>
        </collision>
        <visual name="front_left_wheel_visual">
          <origin xyz="0.01 0 0" rpy="1.5708 0 1.5708"/>     
          <geometry>
            <cylinder length="0.04" radius="0.055"/>
          </geometry>
        </visual>
        <inertial>
          <origin xyz="0 0 0"/>
          <mass value="0.5"/>
          <inertia 
          ixx="0.005" ixy="0.0" ixz="0.0" 
          iyy="0.01" iyz="0.0" 
          izz="0.005"/>
        </inertial>
    </link>

    <link name="front_right_wheel">
        <collision name="collision">
          <origin xyz="0.31 0 0" rpy="1.5708 0 1.5708"/>
          <geometry>
            <cylinder length="0.04" radius="0.055"/>
          </geometry>
          <surface>
            <friction>
              <ode>
                <mu>10</mu>
                <mu2>10</mu2>
              </ode>
            </friction>
          </surface>
        </collision>
        <visual name="front_right_wheel_visual">
          <origin xyz="0.31 0 0" rpy="1.5708 0 1.5708"/>
          <geometry>
            <cylinder length="0.04" radius="0.055"/>
          </geometry>
        </visual>
        <inertial>
          <origin xyz="0 0 0"/>
          <mass value="0.5"/>
          <inertia 
          ixx="0.005" ixy="0.0" ixz="0.0" 
          iyy="0.01" iyz="0.0" 
          izz="0.005"/>
        </inertial>
    </link>

    <joint type="continuous" name="front_left_wheel_hinge">
        <child link="front_left_wheel"/>
        <parent link="base_link"/>
        <origin xyz="0 0.16 0" />
        <axis xyz="1 0 0" rpy="0 0 0"/>
        <limit effort="1" velocity="10"/>
        <joint_properties damping="5.0" friction="1.0"/>
    </joint>
    <transmission name="front_left_wheel_trans" type="SimpleTransmission">
        <type>transmission_interface/SimpleTransmission</type>
        <actuator name="front_left_wheel_motor">
          <mechanicalReduction>1</mechanicalReduction>
        </actuator>
        <joint name="front_left_wheel_hinge">
          <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
        </joint>
    </transmission>

    <joint type="continuous" name="front_right_wheel_hinge">
        <child link="front_right_wheel"/>
        <parent link="base_link"/>
        <origin xyz="0 0.16 0" />
        <axis xyz="1 0 0" rpy="0 0 0"/>
        <limit effort="1" velocity="10"/>
        <joint_properties damping="5.0" friction="1.0"/>
    </joint>
    <transmission name="front_right_wheel_trans" type="SimpleTransmission">
        <type>transmission_interface/SimpleTransmission</type>
        <actuator name="front_right_wheel_motor">
          <mechanicalReduction>1</mechanicalReduction>
        </actuator>
        <joint name="front_right_wheel_hinge">
          <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
        </joint>
    </transmission>


<!-- Camera -->
    <joint name="astra_joint_base" type="fixed">
        <axis xyz="0 0 0" />
        <!-- <origin xyz="-0.03 0 0.18" rpy="0 0 0"/> -->
        <parent link="base_link"/>
        <child link="camera_stand"/>
    </joint>

    <joint name="astra_joint" type="fixed">
        <axis xyz="0 0 0" />
        <!-- <origin xyz="-0.03 0 0.18" rpy="0 0 0"/> -->
        <parent link="camera_stand"/>
        <child link="camera_link"/>
    </joint>

    <link name="camera_link">
        <collision>
          <origin xyz="0.1575 0 0.33" rpy="1.5708 0 -3.14"/>
          <geometry>0
            <box size="0.001 0.001 0.001"/>
          </geometry>
          <material name="black">
            <color rgba="0 0 0 1"/>
          </material>
        </collision>
        <visual>
          <origin xyz="0.1575 0 0.33" rpy="1.5708 0 -3.14"/>
          <geometry>
            <mesh filename="package://husky_description/meshes/astra.dae" scale="0.001 0.001 0.001" />
          </geometry>
        </visual>
   <!--      <inertial>
          <mass value="1e-5" />
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <inertia ixx="0" ixy="0" ixz="0" iyy="0" iyz="0" izz="0" />
        </inertial> -->
    </link>

    <link name='camera_stand'>
    <!--       <inertial>
          <mass value="5"/>
          <origin xyz="0 0 0.5" rpy=" 0 0 0"/>
          <inertia 
          ixx="100" ixy="0.0" ixz="0"
          iyy="100" iyz="0.0"
          izz="100"
          />
        </inertial> -->

        <collision name='collision'>
          <origin xyz="0.1575 0 0.23" rpy="0 0 1.5708"/>
          <geometry>
            <box size="0.04 0.02 0.15" />
          </geometry>
        </collision>

        <visual name='base_link_visual'>
          <origin xyz="0.1575 0 0.23" rpy="0 0 1.5708"/>
          <geometry>
              <box size="0.04 0.02 0.15" />
          </geometry>
          <material name="black">
           <color rgba="0 0 0 0.5"/>
         </material>
        </visual>
    </link>

    <!-- <joint name="camera_optical_joint" type="fixed">
        <origin xyz="0 0 0" rpy="-1.5708 0 -1.5708"/>
        <parent link="camera_link"/>
        <child link="camera_rgb_frame"/>
    </joint>

    <link name="camera_rgb_frame">
    </link>

    <joint name="camera_depth_joint" type="fixed">
        <origin xyz="0 0 0" rpy="-1.5708 0 -1.5708"/>
        <parent link="camera_link"/>
        <child link="camera_depth_frame"/>
    </joint>

    <link name="camera_depth_frame">
    </link> -->


<!-- rplidar Laser -->
  <joint name="rplidar_joint" type="fixed">
    <axis xyz="0 0 1" />
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <parent link="base_link"/>
    <child link="laser"/>
  </joint>

  <link name="laser">
    <collision>
      <origin xyz="0.1575 0.19 0.1575" rpy="1.5708 0 3.14"/>
      <geometry>
        <mesh filename="package://husky_description/meshes/rplidar.dae" scale="0.001 0.001 0.001" />
      </geometry>
    </collision>

    <visual>
      <origin xyz="0.1575 0.19 0.1575" rpy="1.5708 0 3.14"/>
      <geometry>
        <mesh filename="package://husky_description/meshes/rplidar.dae" scale="0.001 0.001 0.001" />
      </geometry>
    </visual>

  <!--   <inertial>
      <mass value="1e-5" />
      <origin xyz="0 0 0.058" rpy="1.5708 0 4.71"/>
      <inertia ixx="0" ixy="0" ixz="0" iyy="0" iyz="0" izz="0" />
    </inertial>
  -->  </link>
  <link name="imu_link"/>
  <joint name="imu_joint" type="fixed">
    <origin xyz="$(optenv HUSKY_IMU_XYZ 0.19 0 0.149)" rpy="$(optenv HUSKY_IMU_RPY 0 -1.5708 3.1416)" />
    <parent link="base_link" />
    <child link="imu_link" />
  </joint>

  <gazebo>
    <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">
      <robotNamespace>$(arg robot_namespace)</robotNamespace>
    </plugin>
  </gazebo>

  <plugin name="imu_controller" filename="libhector_gazebo_ros_imu.so">
    <robotNamespace>$(arg robot_namespace)</robotNamespace>
    <updateRate>50.0</updateRate>
    <bodyName>base_link</bodyName>
    <topicName>imu/data</topicName>
    <accelDrift>0.005 0.005 0.005</accelDrift>
    <accelGaussianNoise>0.005 0.005 0.005</accelGaussianNoise>
    <rateDrift>0.005 0.005 0.005 </rateDrift>
    <rateGaussianNoise>0.005 0.005 0.005 </rateGaussianNoise>
    <headingDrift>0.005</headingDrift>
    <headingGaussianNoise>0.005</headingGaussianNoise>
  </plugin>

  <plugin name="gps_controller" filename="libhector_gazebo_ros_gps.so">
    <robotNamespace>$(arg robot_namespace)</robotNamespace>
    <updateRate>40</updateRate>
    <bodyName>base_link</bodyName>
    <frameId>base_link</frameId>
    <topicName>navsat/fix</topicName>
    <velocityTopicName>navsat/vel</velocityTopicName>
    <referenceLatitude>49.9</referenceLatitude>
    <referenceLongitude>8.9</referenceLongitude>
    <referenceHeading>0</referenceHeading>
    <referenceAltitude>0</referenceAltitude>
    <drift>0.0001 0.0001 0.0001</drift>
  </plugin>


</robot>
